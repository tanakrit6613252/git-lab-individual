<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Electricity Usage Dashboard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="style.css">

  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>

<header>
  <h1>âš¡ Electricity Usage Dashboard</h1>
  <p>Electricity consumption overview</p>
</header>

<main>

  <!-- Summary cards -->
  <section class="summary">
    <div class="summary-card">
      <h3>Total Provinces</h3>
      <span id="provinceCount">0</span>
    </div>
    <div class="summary-card">
      <h3>Total Usage (kWh)</h3>
      <span id="totalUsage">0</span>
    </div>
  </section>

  <!-- Charts -->
  <section class="charts">
    <div class="chart-card">
      <h3>Electricity Usage by Province</h3>
      <canvas id="usageChart"></canvas>
    </div>

    <div class="chart-card">
      <h3>User Distribution</h3>
      <canvas id="userChart"></canvas>
    </div>
  </section>

</main>

<script>
Promise.all([
  fetch("electricity_usages_en.json").then(res => res.json()),
  fetch("electricity_users_en.json").then(res => res.json())
])
.then(([usageData, userData]) => {

  const usages = usageData.Sheet1 || usageData;

  // ===== Summary =====
  document.getElementById("provinceCount").textContent = usages.length;

  const totalUsageValue = usages.reduce((sum, u) =>
    sum + u.residential_kwh + u.small_business_kwh +
    u.medium_business_kwh + u.large_business_kwh
  , 0);

  document.getElementById("totalUsage").textContent =
    totalUsageValue.toLocaleString();

  // ===== Bar Chart =====
  const provinceNames = usages.map(u => u.province_name);
  const usageTotals = usages.map(u =>
    u.residential_kwh + u.small_business_kwh +
    u.medium_business_kwh + u.large_business_kwh
  );

  new Chart(document.getElementById("usageChart"), {
    type: "bar",
    data: {
      labels: provinceNames,
      datasets: [{
        label: "Total Usage (kWh)",
        data: usageTotals
      }]
    },
    options: {
      responsive: true,
      plugins: {
        legend: { display: false }
      }
    }
  });

  // ===== Pie Chart =====
  const totalResidential = userData.reduce((s,u)=>s+u.residential_count,0);
  const totalSmall = userData.reduce((s,u)=>s+u.small_business_count,0);
  const totalLarge = userData.reduce((s,u)=>s+u.large_business_count,0);

  new Chart(document.getElementById("userChart"), {
    type: "pie",
    data: {
      labels: ["Residential", "Small Business", "Large Business"],
      datasets: [{
        data: [totalResidential, totalSmall, totalLarge]
      }]
    },
    options: {
      responsive: true
    }
  });

})
.catch(err => console.error(err));
</script>

</body>
</html>
